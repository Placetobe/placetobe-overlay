<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">

<!--
`placetobe-popup`
Placetobe Popup

@demo demo/index.html 
-->

<dom-module id="placetobe-popup">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        z-index: 9;
      }

      :host section {
        @apply(--placetobe-border-box);
        @apply(--placetobe-flex-layout-vertical);
        @apply(--placetobe-cross-align-stretch);
        background-color: white;
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        padding: var(--placetobe-margin);
      }

      :host section svg {
        position: absolute;
        width: calc(var(--placetobe-margin) * 2);
        height: calc(var(--placetobe-margin) * 2);
        top: calc( var(--placetobe-margin) / 3 * 2);
        right: calc( var(--placetobe-margin) / 2 );
        cursor: pointer;
      }

      :host section svg g {
        stroke: var(--placetobe-color-darkblue);
      }

      :host #container {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0,0,0, .4);
        @apply --placetobe-flex-layout;
        @apply --placetobe-flex-align--center;
        @apply --placetobe-cross-align--center;
      }

      :host #container[hidden] {
        display: none;
      }

      @media(min-width: 601px) {
        :host section {
          @apply --placetobe-flex-item--1;
          @apply(--placetobe-box-shadow);
          @apply(--placetobe-border-radius);
          -ms-flex: 1 0 auto;
          height: auto;
          width: calc( 100vw - (var(--placetobe-margin) * 2) );
          max-width: calc( var(--placetobe-layout-width) + (var(--placetobe-margin) * 2) );
          top: auto;
          bottom: auto;
          left: auto;
          right: auto;
          position: relative;
        }

        :host section ::slotted(* > :first-child) {
          min-height: calc( var(--placetobe-margin) * 25 );
        }

      }

    </style>

    <div
      id="container"
      on-tap="_handleTapContainer"
      hidden$="[[!opened]]">
      <section>
        <slot></slot>
          <svg viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" on-tap="close">
            <g>
              <path d="M35.6509863,35.6509863 L18,18" stroke-width="2" stroke-linecap="square"></path>
              <path d="M35.6509863,35.6509863 L18,18" stroke-width="2" stroke-linecap="square" transform="translate(26.825493, 26.825493) scale(-1, 1) translate(-26.825493, -26.825493) "></path>
            </g>
          </svg>
      </section>



    </div>

  </template>

  <script>
    Polymer({

      is: 'placetobe-popup',

      properties: {
        opened: {
          type: Boolean,
          value: false,
          reflectToAttribute: true,
          notify: true,
          observer: '_handleOpenedChanged'
        }
      },

      _handleTapContainer: function(evt) {
        if(evt.target.isEqualNode(this.$.container)) {
          this.close();
        }
      },

      _handleOpenedChanged: function(newValue, oldValue) {
        if(newValue === true && oldValue === false) {
          this.fire('popup-opened')
        }
        if(newValue === false && oldValue === true) {
          this.fire('popup-closed')
        }
      },

      close: function() {
        this.opened = false;        
      }

    });
  </script>
</dom-module>
